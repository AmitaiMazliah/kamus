apiVersion: v1
kind: ServiceAccount
metadata:
  name: crd-controller
---
apiVersion: v1
kind: Secret
metadata:
  name: tls-certificate
type: Opaque
data:
  certificate.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPakNDQWlLZ0F3SUJBZ0lSQU5UR1BIemdTbFhHTHpZZUI0S2pHcUF3RFFZSktvWklodmNOQVFFTEJRQXcKRXpFUk1BOEdBMVVFQXhNSWEyRnRkWE10WTJFd0hoY05NakF3T1RFME1UQXpNVFUwV2hjTk16QXdPVEV5TVRBegpNVFUwV2pBUU1RNHdEQVlEVlFRREV3VnJZVzExY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDCkFRb0NnZ0VCQU1PQnVuVWZJdHZiV0hLTnZMdFhTOWp4R21GRExiS09JVTJHOXdDUlhZVzBLSk9acjdqZlI2QWkKMEFxOGg4cUVvWnNyTzlxbWk2N3Q3ZnNnVnBaZXJlZjh6OHVPNURDbVp3bWF0THYzcXdyWG94NmFRempnVTVUYQpIcHNuaG5YZU5DKzVGU3NFRzdaR2UwNjFyRzlnTVI2SmhBMlpZVWNDVDNtYmgrc2VDYmtDRkpqaWJzSmpDRWpZCmJsRGxKNjBZb1NjdWtqK3VtOTlIYlUzbllWb0Q0c1RIblZEVHlTUjc2RmJRZm1XZ0ZCUUZsR3Nzd2R0Q2FZbW0KVEZ6cWU1TVZ6TTNybFNTZ2RueHMxUHBsRGVWcjZJVGRmdmhIUXRoTUMyZTN3aE5adGdBQk14cnhkZ0U1Z2lBUApyNUJBQS9TZnpld3lyTUhNQ3BIbmZGbHFsaGNDZ0xFQ0F3RUFBYU9CaXpDQmlEQU9CZ05WSFE4QkFmOEVCQU1DCkJhQXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0VHQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXcKU1FZRFZSMFJCRUl3UUlJY2EyRnRkWE10WTI5dWRISnZiR3hsY2k1MFpXRnRMV1JsZG05d2M0SWdhMkZ0ZFhNdApZMjl1ZEhKdmJHeGxjaTUwWldGdExXUmxkbTl3Y3k1emRtTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSEZaClVzN2taaCtiRkxMOVl5eU1Rd1lQUTJuMXMvU3RxTHYyUjU0SjVCcjJKaFpYZ2R0RHhlQThEazhYdDNubHJZUisKTkdqWFc0LzZJTkw0TWZ3amRBeHhTRGRSeEFua1BuRTl4T0pxRWxTd0pxbThnaFF2b3plU1J1TTArbW1tUnRndQpEcnBIZVIvTURYMFZETHYxTXBhYnkxM2I3QUFSK0Y2aUhlRkdvYnlwbnJKMTM0Tk9TRXJmTVVtNnVydWQzUFUxCnFyT010dk5KSi9NRmp3dkdUa1pMclIwMUwvcHBMaUZVbkRzcUs2TG8zLzBYVzZCT1NXTUFnb2VMZ2J6NER3MmYKUnJyRjhDaVUzaUVHZlprNStCbWdOMTBQVjBsemowZDk3RzhkZTFGcWlaSDVaMU9DVHVNa1V5czFTZk5ITWRXVApzSlBjd1VPdktwa2VTKzk3aURzPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  privateKey.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBdzRHNmRSOGkyOXRZY28yOHUxZEwyUEVhWVVNdHNvNGhUWWIzQUpGZGhiUW9rNW12CnVOOUhvQ0xRQ3J5SHlvU2hteXM3MnFhTHJ1M3QreUJXbGw2dDUvelB5NDdrTUtabkNacTB1L2VyQ3RlakhwcEQKT09CVGxOb2VteWVHZGQ0MEw3a1ZLd1FidGtaN1RyV3NiMkF4SG9tRURabGhSd0pQZVp1SDZ4NEp1UUlVbU9KdQp3bU1JU05odVVPVW5yUmloSnk2U1A2NmIzMGR0VGVkaFdnUGl4TWVkVU5QSkpIdm9WdEIrWmFBVUZBV1VheXpCCjIwSnBpYVpNWE9wN2t4WE16ZXVWSktCMmZHelUrbVVONVd2b2hOMSsrRWRDMkV3TFo3ZkNFMW0yQUFFekd2RjIKQVRtQ0lBK3ZrRUFEOUovTjdES3N3Y3dLa2VkOFdXcVdGd0tBc1FJREFRQUJBb0lCQUI0UHEzam8wYlpXa3RJQwpZenUzSDQxNi9TQnBjUFJja0ZoWVlWQndDWjVPWmxMVHRjWktacndEdmxONFM3VGpFZXBIQ293RFFjVWpCbzJ2Cm1rREN6Q0M0cWNiVjhOWmVMOGUxUndjRC9RUE14bU1sT3lMYXMxOVc3by9TMHdUNnByR1QxdUpuWGs5M3BPd2sKV1NCQy9TcUI0SkVxdlY5cXhvZWZWNVhhWjRwUHQ2YVR6ZW5DcUlRUkpEclM0bnVrdUo5YTZWSXpCV3NaMUl0TQp4djhtM2lVQll5QVVJZHhOZkZKZGNJSjZNRHJJanlHcFI1RllWemZGMXdiUXFPcXdYdUpCQThnaUZzNFd2czhuCk9MUlRrMjNMSUh3cStaaUZNdDRKbjBRVm1qcGljTHFKNFFjYzF0RkZCOU45VXhGS3dQaUJuSTVNQWVXK25nbysKQ29aM3RrRUNnWUVBN2dyejNGcXRJSklidDhNZFVaM3VUVzgxbWxLbVlTSHdjTEREd09UYWlPUm1oQy9ITHowMQpaZWxicmQ3dHYxYXRNLy8zeVBESmhra21VOEwvaU8wTDQxZHJqb09UdEhoaVR2UkpjSlFndDVhMVorR2FIaHVRCmk1cUlyb0J4cXVCSzhKaFBsSzBsdkIzUmp0SVUwdDJnLytGSzk1L1I1c1ZXYWhWUWl1M0hRZ2tDZ1lFQTBrRlQKZmJZcmtqd3JjWHJ0ZWtrQmhWVGJRT2p1Nzdla2xLNWhiWm1SeCs1M0dGUnBESjViSmJzU29UbXRuUDJNSnliVgpVYW00QU5oZHA2VnZGVGNRcDZ6Uk42ZmpDNklYM1FsVlhNQkhRbm13VTZ1cFVENEx4R21wbUJjd3ZpeWdOTGRiClBkbjJORnpXcmNaWVdMcjhOUGw5QWU2NDN2d2kwbUNuZWNqRDAya0NnWUJUN09TaGNnN01CdmRpeUpYVHFyelQKN0R1WDF6LzF5d044bDdYTWttTkNGRlRZa2dmRjdleWZxN0M1RW5uOEZkRW5IajM4U0hpa3NiR2pvb0o1Z2luSQowNCtHUlhtVURVV0wxTEQzMGlIZTJISEkyRStBQWZQcVpHZUFMcVRrdkFOdjVDTmFwZGxDQTdsWWcxVDRLMCtTCko1cEl4NzQzZ0tmQTZ4YmtoSVRXRVFLQmdBTFBkTG85Y1IrblJqMWlFMEtMTDBZRStGbEp3OGZZZ0k2c05na3QKQUZIWDBpZTFHU0plQzRIWm1rb2xaeml0K3UyYkMwYm9LZGw1Q3VkdXdxbFo3eE1Pc0UwNkpVTEdpK01jZU5PZwpqbE5KSlI0NU1TNHRaaUxkOXJKZHZQME53Nlp3dlB0NnFsdlEwZDNJeE8yS3NreFMrV1RKT0JkaTcyUTRmb1NXCk5tZmhBb0dBWjhRQWdQK2UwOHdYTmtjYWxQM2MzNTBsUUpaZ0pKVXA0ZFFpWUZQT0Z1RjlKdTFYQzZXczl4KzMKWnM4eVZmQzBFRWFwcW9vVVBPTkZJWXRMaFlPMDJqSzRqeGYxTHhUZ2E1a0Z4VjFsOW81UmNicThCckFYVEpZYgprenZzbENvZWpGN1ZqWEVZT1l5OHpyWVpkajRjMjdOQndFZFArSjMrNitvS3FzMXJ4SkE9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: default
  name: kamus-crd
rules:
- apiGroups: ["soluto.com"] # "" indicates the core API group
  resources: ["kamussecrets"]
  verbs: ["watch"]
- apiGroups: [""] # "" indicates the core API group
  resources: ["secrets"]
  verbs: ["create", "delete", "patch"]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: crd-controller
subjects:
- kind: ServiceAccount
  name: crd-controller
  namespace: default
roleRef:
  kind: ClusterRole
  name: kamus-crd
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: Service
metadata:
  name: kamus-crd
  labels:
    app: kamus
    component: crd-controller
    heritage: Tiller
spec:
  type: ClusterIP
  ports:
    - port: 443
      targetPort: 8888
      protocol: TCP
      name: http-kamus-controller
  selector:
    app: kamus
    component: crd-controller
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kamus-crd-controller
  labels:
    app: kamus
    component: crd-controller
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kamus
      component: crd-controller
  template:
    metadata:
      labels:
        app: kamus
        component: crd-controller
    spec:
      serviceAccountName: crd-controller
      containers:
      - name: controller
        image: crd-controller
        imagePullPolicy: IfNotPresent
        env:
        - name: TLS_CERT_FOLDER
          value: "/home/dotnet/https"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 9999        
        readinessProbe:
          httpGet:
            path: /healthz
            port: 9999
        volumeMounts:
          - name: foo
            mountPath: "/home/dotnet/https/"
            readOnly: true
      volumes:
      - name: foo
        secret:
          secretName: tls-certificate
